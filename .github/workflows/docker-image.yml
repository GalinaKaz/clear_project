name: DockerImageCI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

      
jobs:

  docker:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Login to DockerHub
      uses: docker/login-action@v1 
      with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      
    # Build the Docker image
    - name: Build
      run: |-
        docker build \
          --tag "galinakaz/app-dima:$GITHUB_SHA" \
          --build-arg GITHUB_SHA="$GITHUB_SHA" \
          --build-arg GITHUB_REF="$GITHUB_REF" \
          .

    # Push the Docker image to Google Container Registry
    - name: Publish
      run: |-
        docker push "galinakaz/app-dima:$GITHUB_SHA"
    
  Kubernetes:
    runs-on: 10.100.102.73
    steps:
    - name: Login to my computer
      uses: docker/login-action@v1 
      with:
          username: ${{ secrets.my_USERNAME }}
          password: ${{ secrets.my_TOKEN }}
          
    # Deploy the Docker image to microk8s kubernetes Cluster on my computer
    - name: Deploy
      run: |-
        echo env

